<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="ç”Ÿæ´»ç§‘æŠ€æ•™å®¤å®‰å…¨æ•™è‚²äº’å‹•æ¸¬é©—ï¼šå­¸ç¿’æ­£ç¢ºçš„ç‡™å‚·æ€¥æ•‘ SOP (æ²–è„«æ³¡è“‹é€)ã€‚">
    <meta property="og:title" content="ç‡™å‚·æ€¥æ•‘å¤§ä½œæˆ°">
    <meta property="og:description" content="ä½ èƒ½åšå‡ºæ­£ç¢ºçš„åˆ¤æ–·å—ï¼Ÿç”Ÿæ´»ç§‘æŠ€å®‰å…¨æ•™è‚²äº’å‹•å°éŠæˆ²ã€‚">
    <title>ç”Ÿæ´»ç§‘æŠ€æ•™å®¤ï¼šç‡™å‚·æ€¥æ•‘å¤§ä½œæˆ°</title>
    
    <!-- å‹•æ…‹ç”Ÿæˆ Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸš‘</text></svg>">

    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- å¼•å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- é…ç½® Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'blob': 'blob 7s infinite',
                        'pop': 'pop 0.3s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        shake: {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '10%, 30%, 50%, 70%, 90%': { transform: 'translateX(-4px)' },
                            '20%, 40%, 60%, 80%': { transform: 'translateX(4px)' },
                        },
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        pop: {
                            '0%': { transform: 'scale(0.8)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', system-ui, -apple-system, sans-serif;
            background-color: #f0f4f8;
            -webkit-tap-highlight-color: transparent;
        }

        /* è‡ªå®šç¾©æ»¾å‹•æ¢ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        /* ç»ç’ƒæ“¬æ…‹æ•ˆæœ */
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- éŸ³æ•ˆåˆæˆå™¨ (Web Audio API) ---
        const SoundGenerator = {
            ctx: null,
            init: () => {
                if (!SoundGenerator.ctx) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    SoundGenerator.ctx = new AudioContext();
                }
            },
            play: (type) => {
                if (!SoundGenerator.ctx) SoundGenerator.init();
                const ctx = SoundGenerator.ctx;
                if (ctx.state === 'suspended') ctx.resume(); // ç¢ºä¿ç€è¦½å™¨å…è¨±æ’­æ”¾

                const t = ctx.currentTime;
                
                switch (type) {
                    case 'correct':
                        // å®å’šï¼ (é«˜éŸ³æ­£å¼¦æ³¢æ»‘éŸ³)
                        const osc1 = ctx.createOscillator();
                        const gain1 = ctx.createGain();
                        osc1.type = 'sine';
                        osc1.frequency.setValueAtTime(523.25, t); // C5
                        osc1.frequency.exponentialRampToValueAtTime(880, t + 0.1); // A5
                        gain1.gain.setValueAtTime(0.1, t);
                        gain1.gain.exponentialRampToValueAtTime(0.01, t + 0.6);
                        osc1.connect(gain1);
                        gain1.connect(ctx.destination);
                        osc1.start(t);
                        osc1.stop(t + 0.6);
                        break;
                    case 'wrong':
                        // éŒ¯èª¤éŸ³æ•ˆ (ä½éŸ³é‹¸é½’æ³¢)
                        const osc2 = ctx.createOscillator();
                        const gain2 = ctx.createGain();
                        osc2.type = 'sawtooth';
                        osc2.frequency.setValueAtTime(150, t);
                        osc2.frequency.linearRampToValueAtTime(100, t + 0.3);
                        gain2.gain.setValueAtTime(0.1, t);
                        gain2.gain.linearRampToValueAtTime(0.01, t + 0.3);
                        osc2.connect(gain2);
                        gain2.connect(ctx.destination);
                        osc2.start(t);
                        osc2.stop(t + 0.3);
                        break;
                    case 'click':
                        // è¼•å¾®é»æ“Šè²
                        const osc3 = ctx.createOscillator();
                        const gain3 = ctx.createGain();
                        osc3.frequency.setValueAtTime(600, t);
                        gain3.gain.setValueAtTime(0.05, t);
                        gain3.gain.exponentialRampToValueAtTime(0.01, t + 0.1);
                        osc3.connect(gain3);
                        gain3.connect(ctx.destination);
                        osc3.start(t);
                        osc3.stop(t + 0.1);
                        break;
                    case 'victory':
                        // å‹åˆ©éŸ³æ¨‚ (Cå¤§èª¿ç¶éŸ³)
                        [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
                            const osc = ctx.createOscillator();
                            const gain = ctx.createGain();
                            osc.type = 'triangle';
                            osc.frequency.value = freq;
                            gain.gain.setValueAtTime(0.05, t + i * 0.1);
                            gain.gain.exponentialRampToValueAtTime(0.01, t + i * 0.1 + 0.6);
                            osc.connect(gain);
                            gain.connect(ctx.destination);
                            osc.start(t + i * 0.1);
                            osc.stop(t + i * 0.1 + 0.6);
                        });
                        break;
                    case 'gameover':
                        // å¤±æ•—éŸ³æ¨‚ (ä¸‹è¡ŒéŸ³éš)
                        [440, 415, 392, 370].forEach((freq, i) => {
                            const osc = ctx.createOscillator();
                            const gain = ctx.createGain();
                            osc.type = 'triangle';
                            osc.frequency.value = freq;
                            gain.gain.setValueAtTime(0.1, t + i * 0.3);
                            gain.gain.linearRampToValueAtTime(0.01, t + i * 0.3 + 0.6);
                            osc.connect(gain);
                            gain.connect(ctx.destination);
                            osc.start(t + i * 0.3);
                            osc.stop(t + i * 0.3 + 0.6);
                        });
                        break;
                }
            }
        };

        // --- è³‡æ–™è¨­å®š ---
        const GAME_STATES = {
            START: 'start',
            PLAYING: 'playing',
            GAME_OVER: 'game_over',
            VICTORY: 'victory',
            LEARNING: 'learning'
        };

        // --- Icons Components (SVG) ---
        const IconBase = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );

        const Icons = {
            Flame: (props) => <IconBase {...props}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-2.24-4.056-2.953-5.26a1.996 1.996 0 0 1 2.37-2.673C11.956 2.362 13.986 4.6 14.392 7.234a4.004 4.004 0 0 0 2.227-2.173 8.01 8.01 0 0 1 1.764 7.641 2.497 2.497 0 0 0 .543 2.58c1.378 1.48 2.074 2.3 2.074 4.218C21 21.61 19.388 23 17.5 23h-9C5.322 23 4 21.572 4 19.5c0-2.486 1.83-4.5 4.5-5z"/></IconBase>,
            School: (props) => <IconBase {...props}><path d="M14 22v-4a2 2 0 1 0-4 0v4"/><path d="m18 10 4 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8l4-2"/><path d="M18 5v17"/><path d="m4 6 8-4 8 4"/><path d="M6 5v17"/><circle cx="12" cy="9" r="2"/></IconBase>,
            Droplets: (props) => <IconBase {...props}><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.35c.71-1.11 1.16-2.33 1.16-4.02 0-1.28-.45-2.53-1.69-3.75"/></IconBase>,
            Bandage: (props) => <IconBase {...props}><path d="M14 12v.01"/><path d="M10 12v.01"/><path d="M8.5 14c0 1.1-.9 2-2 2h-1c-1.1 0-2-.9-2-2V8c0-1.1.9-2 2-2h1c1.1 0 2 .9 2 2v6Z" transform="rotate(-45 12 12)"/><path d="M17.5 10c0 1.1-.9 2-2 2h-1c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h1c1.1 0 2 .9 2 2v6Z" transform="rotate(45 12 12)"/></IconBase>,
            Ambulance: (props) => <IconBase {...props}><path d="M10 10h4"/><path d="M12 8v4"/><path d="M19 17h1.5c.3 0 .6-.1.8-.4l2-3c.2-.3.2-.6.2-1v-4c0-.6-.4-1-1-1H16"/><path d="M4 17h3"/><path d="M7 17a3 3 0 0 1 3 3v0a3 3 0 0 1-3 3 3 3 0 0 1-3-3v0a3 3 0 0 1 3-3Z"/><path d="M15 17h1"/><path d="M16 17a3 3 0 0 1 3 3v0a3 3 0 0 1-3 3 3 3 0 0 1-3-3v0a3 3 0 0 1 3-3Z"/><path d="M10 17h6"/><path d="M1 5h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1Z"/></IconBase>,
            AlertTriangle: (props) => <IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></IconBase>,
            CheckCircle: (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>,
            XCircle: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></IconBase>,
            Scissors: (props) => <IconBase {...props}><circle cx="6" cy="6" r="3"/><path d="M8.12 8.12 12 12"/><path d="M20 4 8.12 15.88"/><circle cx="6" cy="18" r="3"/><path d="M14.8 14.8 20 20"/></IconBase>,
            ThermometerSnowflake: (props) => <IconBase {...props}><path d="M2 12h10"/><path d="M9 4v16"/><path d="m3 9 3 3-3 3"/><path d="M12 6a9 9 0 0 0 0 12v-3"/><path d="M12 3a9 9 0 0 1 9 9 9 9 0 0 1-9 9"/></IconBase>,
            RefreshCw: (props) => <IconBase {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>,
            Heart: (props) => <IconBase {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></IconBase>,
            ChevronRight: (props) => <IconBase {...props}><path d="m9 18 6-6-6-6"/></IconBase>,
            Volume2: (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></IconBase>,
            VolumeX: (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></IconBase>
        };

        const SCENARIOS = [
            {
                stepName: "ç¬¬ä¸€æ­¥ï¼šæ²–",
                description: "ä½ åœ¨ç„Šæ¥é›»è·¯æ¿æ™‚ï¼Œä¸å°å¿ƒè¢«é«˜æº«çš„é›»çƒ™éµç‡™åˆ°äº†æ‰‹èƒŒï¼ç¾åœ¨éå¸¸ç—›ï¼Œä½ è©²æ€éº¼åšï¼Ÿ",
                icon: <Icons.Flame className="w-16 h-16 text-orange-500 animate-pulse drop-shadow-md" />,
                options: [
                    { id: 'ice', text: "ç›´æ¥æ‹¿å†°å¡Šå†°æ•·", type: 'wrong', feedback: "éŒ¯èª¤ï¼ç›´æ¥å†°æ•·æœƒé€ æˆè¡€ç®¡éåº¦æ”¶ç¸®ï¼Œç”šè‡³å°è‡´å‡å‚·ã€‚" },
                    { id: 'water', text: "ç”¨æµå‹•çš„å†·æ°´æ²–æ´—å‚·å£", type: 'correct', feedback: "æ­£ç¢ºï¼æµå‹•çš„å†·æ°´å¯ä»¥å¸¶èµ°ç†±èƒ½ï¼Œé™ä½çµ„ç¹”å‚·å®³ã€‚è‡³å°‘æ²–æ´—15-30åˆ†é˜ã€‚" },
                    { id: 'paste', text: "å¡—æŠ¹ç‰™è†æˆ–è—¥è†", type: 'wrong', feedback: "éŒ¯èª¤ï¼å¡—æŠ¹ç‰™è†æœƒä¸åƒ…ç„¡æ³•é™æº«ï¼Œé‚„æœƒé€ æˆå‚·å£æ„ŸæŸ“ï¼Œå¢åŠ é†«ç”Ÿè™•ç†é›£åº¦ã€‚" }
                ]
            },
            {
                stepName: "ç¬¬äºŒæ­¥ï¼šè„«",
                description: "å·²ç¶“æ²–æ°´ä¸€é™£å­äº†ï¼Œä½†ä½ ç©¿è‘—é•·è¢–çš„å¯¦ç¿’å·¥å» åˆ¶æœï¼Œè¢–å­è¦†è“‹åœ¨å‚·å£ä¸Šã€‚ä¸‹ä¸€æ­¥ï¼Ÿ",
                icon: <Icons.School className="w-16 h-16 text-blue-500 drop-shadow-md" />,
                options: [
                    { id: 'rip', text: "ç”¨åŠ›æŠŠè¢–å­æ‰¯ä¸‹ä¾†", type: 'wrong', feedback: "éŒ¯èª¤ï¼å¼·è¡Œè„«æ‰å¯èƒ½æœƒé€£åŒæ°´æ³¡æˆ–çš®è†šä¸€èµ·æ’•ä¸‹ï¼Œé€ æˆäºŒæ¬¡å‚·å®³ã€‚" },
                    { id: 'cut', text: "åœ¨æ°´ä¸­å°å¿ƒå‰ªé–‹æˆ–è„«å»è¡£ç‰©", type: 'correct', feedback: "æ­£ç¢ºï¼åˆ©ç”¨æ°´çš„æ½¤æ»‘ï¼Œå°å¿ƒåœ°å‰ªé–‹æˆ–ç§»é™¤è¡£ç‰©ã€‚å¦‚æœé»ä½çš®è†šå°±ä¸è¦ç¡¬è„«ã€‚" },
                    { id: 'wait', text: "å…ˆä¸è¦ç®¡è¡£æœï¼Œç¹¼çºŒæ²–", type: 'wrong', feedback: "ä¸å®Œå…¨æ­£ç¢ºã€‚å¦‚æœä¸ç§»é™¤è¡£ç‰©ï¼Œç†±èƒ½æœƒè¢«åŒ…åœ¨è¡£æœè£¡æŒçºŒå‚·å®³çš®è†šã€‚" }
                ]
            },
            {
                stepName: "ç¬¬ä¸‰æ­¥ï¼šæ³¡",
                description: "è¡£ç‰©å·²ç¶“ç§»é™¤äº†ã€‚ç‚ºäº†æŒçºŒé™æº«ä¸¦æ¸›è¼•ç–¼ç—›ï¼Œä½ æ‡‰è©²ï¼Ÿ",
                icon: <Icons.Droplets className="w-16 h-16 text-cyan-400 drop-shadow-md" />,
                options: [
                    { id: 'soak', text: "ç¹¼çºŒæµ¸æ³¡åœ¨å†·æ°´ä¸­", type: 'correct', feedback: "æ­£ç¢ºï¼æµ¸æ³¡å†·æ°´ï¼ˆç´„15-30åˆ†é˜ï¼‰å¯ä»¥æŒçºŒé™æº«ä¸¦æ¸›è¼•ç–¼ç—›ã€‚" },
                    { id: 'alcohol', text: "æµ¸æ³¡åœ¨é…’ç²¾è£¡æ¶ˆæ¯’", type: 'wrong', feedback: "éŒ¯èª¤ï¼é…’ç²¾æœƒåˆºæ¿€å‚·å£ï¼Œé€ æˆåŠ‡çƒˆç–¼ç—›ä¸¦ç ´å£çµ„ç¹”ã€‚" },
                    { id: 'soy', text: "å¡—æŠ¹é†¬æ²¹", type: 'wrong', feedback: "éŒ¯èª¤ï¼é€™æ˜¯åæ–¹ï¼Œå®¹æ˜“é€ æˆå‚·å£æ„ŸæŸ“ç™¼ç‚ã€‚" }
                ]
            },
            {
                stepName: "ç¬¬å››æ­¥ï¼šè“‹",
                description: "ç–¼ç—›æ„Ÿç¨å¾®æ¸›è¼•äº†ã€‚ç¾åœ¨è¦æº–å‚™å‰å¾€ä¿å¥å®¤æˆ–é†«é™¢ï¼Œä¿è­·å‚·å£è©²æ€éº¼åšï¼Ÿ",
                icon: <Icons.Bandage className="w-16 h-16 text-emerald-500 drop-shadow-md" />,
                options: [
                    { id: 'tissue', text: "ç”¨è¡›ç”Ÿç´™åŒ…èµ·ä¾†", type: 'wrong', feedback: "éŒ¯èª¤ï¼è¡›ç”Ÿç´™é‡æ°´æœƒçˆ›æ‰ä¸¦é»åœ¨å‚·å£ä¸Šï¼Œæ¥µé›£æ¸…ç†ã€‚" },
                    { id: 'cotton', text: "ç”¨æ£‰èŠ±æ£’æ“¦ä¹¾", type: 'wrong', feedback: "éŒ¯èª¤ï¼æ£‰çµ®æœƒé»åœ¨å‚·å£ä¸Šã€‚" },
                    { id: 'cloth', text: "è“‹ä¸Šä¹¾æ·¨çš„æ¿•å¸ƒæˆ–ç´—å¸ƒ", type: 'correct', feedback: "æ­£ç¢ºï¼ä½¿ç”¨ä¹¾æ·¨ã€æ¿•æ½¤çš„å¸ƒæˆ–ç„¡èŒç´—å¸ƒè¦†è“‹ï¼Œå¯ä»¥ä¿è­·å‚·å£ä¸¦ä¿æŒæ¿•æ½¤ã€‚" }
                ]
            },
            {
                stepName: "ç¬¬äº”æ­¥ï¼šé€",
                description: "å‚·å£å·²ç¶“åˆæ­¥è™•ç†ä¸¦è¦†è“‹å¥½äº†ã€‚æœ€å¾Œä¸€æ­¥ï¼Ÿ",
                icon: <Icons.Ambulance className="w-16 h-16 text-red-500 drop-shadow-md" />,
                options: [
                    { id: 'home', text: "æ²’äº‹äº†ï¼Œå›æ•™å®¤ç¹¼çºŒä¸Šèª²", type: 'wrong', feedback: "éŒ¯èª¤ï¼ç‡™å‚·ç¨‹åº¦éœ€è¦ç”±å°ˆæ¥­äººå“¡åˆ¤æ–·ã€‚" },
                    { id: 'hospital', text: "å„˜é€Ÿé€é†«æˆ–æ‰¾æ ¡è­·è™•ç†", type: 'correct', feedback: "æ­£ç¢ºï¼å°æ–¼åš´é‡æˆ–é¢ç©å¤§çš„ç‡™å‚·ï¼Œå¿…é ˆäº¤ç”±å°ˆæ¥­é†«è­·äººå“¡è™•ç†ã€‚" },
                    { id: 'wait', text: "åœ¨æ•™å®¤ä¼‘æ¯ç­‰å®ƒå¥½", type: 'wrong', feedback: "éŒ¯èª¤ï¼å»¶èª¤æ²»ç™‚å¯èƒ½æœƒå°è‡´ç•™ç–¤æˆ–æ„ŸæŸ“ã€‚" }
                ]
            }
        ];

        // --- å­å…ƒä»¶ ---
        
        const Button = ({ onClick, variant = 'primary', className, children, ...props }) => {
            const baseStyles = "w-full py-4 px-6 rounded-xl font-bold shadow-lg transform transition-all active:scale-95 duration-200 flex items-center justify-center gap-2";
            const variants = {
                primary: "bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white shadow-blue-500/30",
                success: "bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-600 hover:to-green-600 text-white shadow-green-500/30",
                danger: "bg-gradient-to-r from-red-500 to-rose-500 hover:from-red-600 hover:to-rose-600 text-white shadow-red-500/30",
                outline: "bg-white border-2 border-gray-200 hover:border-blue-400 hover:bg-blue-50 text-gray-700",
                ghost: "bg-transparent hover:bg-gray-100 text-gray-600 shadow-none",
            };

            return (
                <button 
                    onClick={onClick} 
                    className={`${baseStyles} ${variants[variant]} ${className || ''}`}
                    {...props}
                >
                    {children}
                </button>
            );
        };

        const ProgressBar = ({ current, total }) => (
            <div className="w-full h-3 bg-gray-200 rounded-full mb-6 overflow-hidden shadow-inner">
                <div 
                    className="h-full bg-gradient-to-r from-blue-400 to-blue-600 transition-all duration-700 ease-out rounded-full"
                    style={{ width: `${((current) / total) * 100}%` }}
                ></div>
            </div>
        );

        const HeartContainer = ({ health }) => (
            <div className="flex gap-1.5 bg-white px-3 py-1.5 rounded-full shadow-sm border border-gray-100">
                {[...Array(3)].map((_, i) => (
                    <Icons.Heart 
                        key={i} 
                        className={`w-5 h-5 transition-all duration-300 ${i < health ? 'text-rose-500 fill-rose-500 scale-100' : 'text-gray-200 scale-90'}`} 
                    />
                ))}
            </div>
        );

        // --- ä¸»æ‡‰ç”¨ç¨‹å¼ ---

        function BurnSOPGame() {
            const [gameState, setGameState] = useState(GAME_STATES.START);
            const [currentLevel, setCurrentLevel] = useState(0);
            const [feedback, setFeedback] = useState(null);
            const [health, setHealth] = useState(3);
            const [showExplanation, setShowExplanation] = useState(false);
            const [shake, setShake] = useState(false);
            const [isMuted, setIsMuted] = useState(false);

            // æ’­æ”¾éŸ³æ•ˆè¼”åŠ©å‡½å¼
            const playSound = (type) => {
                if (!isMuted) {
                    SoundGenerator.play(type);
                }
            };

            // æ»¾å‹•åˆ°é ‚éƒ¨
            useEffect(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, [currentLevel, gameState]);

            const startGame = () => {
                playSound('click');
                setGameState(GAME_STATES.PLAYING);
                setCurrentLevel(0);
                setHealth(3);
                setFeedback(null);
                setShowExplanation(false);
            };

            const handleOptionClick = (option) => {
                if (showExplanation) return; 

                if (option.type === 'correct') {
                    playSound('correct');
                    setFeedback({ type: 'correct', text: option.feedback });
                    setShowExplanation(true);
                } else {
                    playSound('wrong');
                    setFeedback({ type: 'wrong', text: option.feedback });
                    setHealth(prev => prev - 1);
                    setShake(true);
                    setTimeout(() => setShake(false), 500);
                    
                    if (health - 1 <= 0) {
                        setTimeout(() => {
                            playSound('gameover');
                            setGameState(GAME_STATES.GAME_OVER);
                        }, 1500);
                    }
                }
            };

            const nextLevel = () => {
                playSound('click');
                if (currentLevel < SCENARIOS.length - 1) {
                    setCurrentLevel(prev => prev + 1);
                    setFeedback(null);
                    setShowExplanation(false);
                } else {
                    playSound('victory');
                    setGameState(GAME_STATES.VICTORY);
                }
            };

            // --- ç•«é¢å…ƒä»¶ ---

            const VolumeControl = () => (
                <button 
                    onClick={() => {
                        setIsMuted(!isMuted);
                        // ç¢ºä¿åˆ‡æ›æ™‚å¦‚æœä¸æ˜¯éœéŸ³ï¼Œå‰‡å˜—è©¦æ’­æ”¾ä¸€å€‹æ¥µçŸ­çš„è²éŸ³ä¾†å–šé†’ AudioContext
                        if (isMuted) SoundGenerator.init();
                    }}
                    className="fixed top-4 right-4 z-50 p-2 bg-white/80 backdrop-blur-sm rounded-full shadow-md text-slate-600 hover:bg-white transition-all"
                    title={isMuted ? "é–‹å•ŸéŸ³æ•ˆ" : "éœéŸ³"}
                >
                    {isMuted ? <Icons.VolumeX className="w-6 h-6" /> : <Icons.Volume2 className="w-6 h-6" />}
                </button>
            );

            const StartScreen = () => (
                <div className="flex flex-col items-center animate-slide-up w-full max-w-md mx-auto">
                    <div className="glass-panel p-8 rounded-3xl shadow-xl border border-white/50 text-center w-full relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>
                        
                        <div className="bg-yellow-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner">
                            <Icons.AlertTriangle className="w-12 h-12 text-yellow-600" />
                        </div>
                        
                        <h1 className="text-3xl md:text-4xl font-black text-slate-800 mb-2 tracking-tight">
                            ç”Ÿæ´»ç§‘æŠ€æ•™å®¤
                        </h1>
                        <h2 className="text-2xl md:text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-orange-500 mb-6">
                            ç‡™å‚·æ€¥æ•‘å¤§ä½œæˆ°
                        </h2>
                        
                        <p className="text-slate-600 mb-8 leading-relaxed">
                            å·¥å» å¯¦ç¿’ç™¼ç”Ÿæ„å¤–äº†ï¼<br/>
                            æŒæ¡é»ƒé‡‘æ€¥æ•‘æ™‚é–“ï¼Œæ­£ç¢ºåŸ·è¡Œ SOPã€‚<br/>
                            <span className="text-sm text-slate-400 mt-2 block">(è«‹æ‰“é–‹è²éŸ³ä»¥ç²å¾—æœ€ä½³é«”é©—)</span>
                        </p>
                        
                        <div className="space-y-4 w-full">
                            <Button onClick={startGame}>
                                é–‹å§‹æŒ‘æˆ° <Icons.ChevronRight className="w-5 h-5"/>
                            </Button>
                            <Button variant="success" onClick={() => { playSound('click'); setGameState(GAME_STATES.LEARNING); }}>
                                <Icons.School className="w-5 h-5"/> å…ˆè¤‡ç¿’ SOP
                            </Button>
                        </div>
                    </div>
                </div>
            );

            const PlayingScreen = () => {
                const scenario = SCENARIOS[currentLevel];
                
                return (
                    <div className="w-full max-w-2xl mx-auto animate-pop">
                        <div className="flex justify-between items-center mb-4 px-1">
                            <div className="text-sm font-bold text-slate-500 bg-white/50 px-3 py-1 rounded-full backdrop-blur-sm">
                                é—œå¡ {currentLevel + 1} / {SCENARIOS.length}
                            </div>
                            <HeartContainer health={health} />
                        </div>
                        
                        <ProgressBar current={currentLevel} total={SCENARIOS.length} />
                        
                        <div className={`glass-panel rounded-3xl shadow-xl overflow-hidden border border-white/60 transition-transform ${shake ? 'animate-shake ring-4 ring-red-200' : ''}`}>
                            {/* å•é¡Œå€å¡Š */}
                            <div className="bg-gradient-to-b from-blue-50/80 to-transparent p-6 md:p-8 flex flex-col items-center text-center">
                                <div className="bg-white p-4 rounded-2xl shadow-sm mb-5 transform transition hover:scale-110 duration-300">
                                    {scenario.icon}
                                </div>
                                <h2 className="text-2xl font-bold text-slate-800 mb-3">{scenario.stepName}</h2>
                                <p className="text-slate-600 text-lg leading-relaxed max-w-lg">
                                    {scenario.description}
                                </p>
                            </div>

                            {/* é¸é …å€å¡Š */}
                            <div className="p-6 md:p-8 pt-2 grid gap-4">
                                {!showExplanation ? (
                                    scenario.options.map((option) => (
                                        <button
                                            key={option.id}
                                            onClick={() => handleOptionClick(option)}
                                            className="group relative flex items-center p-4 md:p-5 bg-white border-2 border-slate-100 rounded-2xl hover:border-blue-400 hover:bg-blue-50/50 hover:shadow-md transition-all text-left active:scale-[0.98]"
                                        >
                                            <div className="bg-slate-100 text-slate-500 font-bold w-10 h-10 rounded-xl flex items-center justify-center mr-4 group-hover:bg-blue-500 group-hover:text-white transition-colors shrink-0">
                                                ?
                                            </div>
                                            <span className="text-lg font-medium text-slate-700 group-hover:text-slate-900">
                                                {option.text}
                                            </span>
                                        </button>
                                    ))
                                ) : (
                                    /* å›é¥‹å€å¡Š */
                                    <div className="animate-slide-up">
                                        <div className={`p-6 rounded-2xl mb-6 flex items-start gap-4 border ${feedback.type === 'correct' ? 'bg-green-50 border-green-200 text-green-900' : 'bg-red-50 border-red-200 text-red-900'}`}>
                                            {feedback.type === 'correct' ? 
                                                <Icons.CheckCircle className="w-8 h-8 shrink-0 text-green-600"/> : 
                                                <Icons.XCircle className="w-8 h-8 shrink-0 text-red-600"/>
                                            }
                                            <div>
                                                <h3 className="font-bold text-xl mb-1">
                                                    {feedback.type === 'correct' ? 'åˆ¤æ–·æ­£ç¢ºï¼' : 'å“å‘€ï¼Œç­”éŒ¯äº†ï¼'}
                                                </h3>
                                                <p className="opacity-90 leading-relaxed">{feedback.text}</p>
                                            </div>
                                        </div>
                                        
                                        {feedback.type === 'correct' ? (
                                            <Button onClick={nextLevel} variant="primary">
                                                ä¸‹ä¸€æ­¥ <Icons.ChevronRight className="w-5 h-5" />
                                            </Button>
                                        ) : (
                                            <Button 
                                                onClick={() => {
                                                    playSound('click');
                                                    setFeedback(null);
                                                    setShowExplanation(false);
                                                }} 
                                                className="bg-slate-700 hover:bg-slate-800 text-white"
                                            >
                                                <Icons.RefreshCw className="w-5 h-5" /> å†è©¦ä¸€æ¬¡
                                            </Button>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const GameOverScreen = () => (
                <div className="flex flex-col items-center animate-pop max-w-md mx-auto">
                    <div className="glass-panel p-8 rounded-3xl shadow-2xl border-t-8 border-red-500 text-center w-full">
                        <Icons.XCircle className="w-24 h-24 text-red-500 mx-auto mb-6 drop-shadow-lg" />
                        <h2 className="text-3xl font-bold text-slate-800 mb-4">ä»»å‹™å¤±æ•—</h2>
                        <p className="text-slate-600 mb-8 text-lg">
                            éŒ¯èª¤çš„è™•ç½®å¯èƒ½æœƒé€ æˆäºŒæ¬¡å‚·å®³ã€‚<br/>
                            åˆ¥æ°£é¤’ï¼Œè¤‡ç¿’ä¸€ä¸‹å£è¨£å†ä¾†ä¸€æ¬¡ï¼
                        </p>
                        <Button onClick={startGame} variant="primary">
                            <Icons.RefreshCw className="w-5 h-5" /> é‡æ–°æŒ‘æˆ°
                        </Button>
                    </div>
                </div>
            );

            const VictoryScreen = () => (
                <div className="flex flex-col items-center animate-pop max-w-lg mx-auto w-full">
                    <div className="glass-panel p-8 md:p-10 rounded-3xl shadow-2xl border-t-8 border-green-500 text-center w-full relative overflow-hidden">
                        {/* èƒŒæ™¯è£é£¾ */}
                        <div className="absolute top-0 left-0 w-full h-full bg-green-50/50 z-0"></div>
                        
                        <div className="relative z-10">
                            <div className="flex justify-center mb-8 relative">
                                <div className="absolute inset-0 bg-green-200 rounded-full blur-xl opacity-50 animate-pulse"></div>
                                <Icons.CheckCircle className="w-24 h-24 text-green-500 relative" />
                            </div>
                            
                            <h2 className="text-4xl font-black text-slate-800 mb-2">æ­å–œé€šé—œï¼</h2>
                            <p className="text-green-600 font-bold text-xl mb-8">ä½ æ˜¯å®‰å…¨å°å°–å…µï¼</p>
                            
                            <div className="bg-white/80 rounded-2xl p-6 text-left mb-8 shadow-sm border border-green-100">
                                <h3 className="font-bold text-slate-700 mb-4 border-b border-green-100 pb-2 text-center">æ€¥æ•‘ SOP ç¸½è¤‡ç¿’</h3>
                                <ul className="space-y-3">
                                    {[
                                        { key: "æ²–", text: "æµå‹•å†·æ°´ 15-30 åˆ†é˜" },
                                        { key: "è„«", text: "æ°´ä¸­å°å¿ƒå‰ªé–‹è¡£ç‰©" },
                                        { key: "æ³¡", text: "æŒçºŒæµ¸æ³¡å†·æ°´é™æº«" },
                                        { key: "è“‹", text: "è¦†è“‹ä¹¾æ·¨æ¿•å¸ƒæˆ–ç´—å¸ƒ" },
                                        { key: "é€", text: "è¦–æƒ…æ³å„˜é€Ÿé€é†«" }
                                    ].map((item, idx) => (
                                        <li key={idx} className="flex items-center gap-3">
                                            <span className="bg-green-100 text-green-700 px-2.5 py-1 rounded-lg text-sm font-black w-8 text-center">{item.key}</span>
                                            <span className="text-slate-600">{item.text}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>

                            <Button onClick={() => { playSound('click'); setGameState(GAME_STATES.START); }} variant="primary">
                                å›åˆ°é¦–é 
                            </Button>
                        </div>
                    </div>
                </div>
            );

            const LearningScreen = () => (
                <div className="w-full max-w-2xl mx-auto animate-slide-up">
                    <div className="glass-panel rounded-3xl shadow-xl overflow-hidden border border-white/50">
                        <div className="bg-gradient-to-r from-emerald-500 to-green-600 p-6 flex items-center gap-4 text-white">
                            <div className="bg-white/20 p-2 rounded-xl">
                                <Icons.School className="w-8 h-8" />
                            </div>
                            <h2 className="text-2xl font-bold">ç‡™å‚·æ€¥æ•‘ SOP çŸ¥è­˜åº«</h2>
                        </div>
                        
                        <div className="p-6 md:p-8 space-y-6">
                            {[
                                { char: "æ²–", text: "æµå‹•å†·æ°´æ²–æ´—å‚·å£15-30åˆ†é˜ï¼Œç›®çš„æ˜¯é™ä½ç†±èƒ½ï¼Œæ¸›å°‘å‚·å®³æ·±åº¦ã€‚", icon: <Icons.Droplets className="text-blue-500"/> },
                                { char: "è„«", text: "åœ¨æ°´ä¸­å°å¿ƒé™¤å»è¡£ç‰©ã€‚è‹¥è¡£æœé»ä½çš®è†šï¼Œä¸å¯å¼·è¡Œæ’•ä¸‹ï¼Œæ‡‰ç”¨å‰ªåˆ€å‰ªé–‹ã€‚", icon: <Icons.Scissors className="text-slate-500"/> },
                                { char: "æ³¡", text: "ç¹¼çºŒæµ¸æ³¡åœ¨å†·æ°´ä¸­15-30åˆ†é˜ï¼Œå¯æ¸›è¼•ç–¼ç—›ä¸¦ç©©å®šæƒ…ç·’ã€‚", icon: <Icons.ThermometerSnowflake className="text-cyan-500"/> },
                                { char: "è“‹", text: "ä½¿ç”¨ä¹¾æ·¨çš„ç´—å¸ƒæˆ–æ¿•æ¯›å·¾è¦†è“‹å‚·å£ï¼Œé¿å…æ„ŸæŸ“åŠæ¥è§¸ç©ºæ°£é€ æˆçš„ç–¼ç—›ã€‚", icon: <Icons.Bandage className="text-emerald-500"/> },
                                { char: "é€", text: "è‹¥å‚·å‹¢åš´é‡ï¼ˆèµ·æ°´æ³¡ã€é¢ç©å¤§ã€æˆ–æ˜¯åŒ–å­¸ç¼å‚·ï¼‰ï¼Œæ‡‰ç«‹å³é€é†«ã€‚", icon: <Icons.Ambulance className="text-red-500"/> },
                            ].map((item, idx) => (
                                <div key={idx} className="flex gap-4 items-start p-4 bg-white rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow">
                                    <div className="bg-slate-50 p-3 rounded-xl shrink-0">
                                        {item.icon}
                                    </div>
                                    <div>
                                        <h3 className="text-2xl font-black text-slate-700 mb-1">{item.char}</h3>
                                        <p className="text-slate-600 leading-relaxed text-sm md:text-base">{item.text}</p>
                                    </div>
                                </div>
                            ))}
                            
                            <div className="pt-4">
                                <Button onClick={() => { playSound('click'); setGameState(GAME_STATES.START); }} variant="success">
                                    æˆ‘çŸ¥é“äº†ï¼Œé–‹å§‹æ¸¬é©—ï¼
                                </Button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // èƒŒæ™¯å‹•ç•«çƒ
            const BackgroundBlobs = () => (
                <div className="fixed inset-0 z-0 overflow-hidden pointer-events-none opacity-60">
                    <div className="absolute top-0 left-10 w-64 h-64 bg-blue-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
                    <div className="absolute top-0 right-10 w-64 h-64 bg-purple-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
                    <div className="absolute -bottom-32 left-20 w-64 h-64 bg-pink-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000"></div>
                </div>
            );

            return (
                <div className="relative min-h-screen py-8 px-4 flex flex-col justify-center">
                    <BackgroundBlobs />
                    <VolumeControl />
                    
                    <div className="relative z-10 w-full">
                        {gameState === GAME_STATES.START && <StartScreen />}
                        {gameState === GAME_STATES.PLAYING && <PlayingScreen />}
                        {gameState === GAME_STATES.GAME_OVER && <GameOverScreen />}
                        {gameState === GAME_STATES.VICTORY && <VictoryScreen />}
                        {gameState === GAME_STATES.LEARNING && <LearningScreen />}
                    </div>

                    <div className="text-center mt-12 text-slate-400 text-xs md:text-sm relative z-10 font-medium tracking-wide">
                        <p>ç”Ÿæ´»ç§‘æŠ€æ•™å®¤å®‰å…¨æ•™è‚²ç´ æ Â© {new Date().getFullYear()}</p>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BurnSOPGame />);
    </script>
</body>
</html>
